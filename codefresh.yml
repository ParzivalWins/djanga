version: '1.0'

steps:
  #clone-jim:
  #  type: git-clone
  #  revision: cfeb549e834714c0447658a8b539a102814a1823
  #  repo: https://github.com/noamt/djanga.git

  unit-test-jim:
    image: alpine:latest
    working-directory: ${{clone-jim}}
    commands: 
      - cd djanga
      - ls -l
      - echo "jimbob"

  integration-tests:
    type: composition
    image: alpine
    working-directory: ${{clone-jim}}
    composition-file: integ-test-composition.yml
    commands:
      - tests/exec.sh

  build-jim:
    type: build
    description: It builds the Jim Service
    dockerfile: Dockerfile
    image-name: blamco/jim
    tag: develop
    working-directory: ${{clone-jim}}
    build-arguments:
      - PORT=9000

  push-dockerhub:
    type: push
    candidate: ${{build-jim}}
    tag: latest

  deploy-aws:
    type: deploy
    image: alpine
    candidate: ${{push-dockerhub}}
    environment:
      - AWS_ID=value
      - AWS_SECRET=value
